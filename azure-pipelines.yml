trigger:
- '*'

variables:
    buildConfiguration: 'Release'
    releaseBranchName: 'release'

schedules:
- cron: '0 3 * * *'
  displayName: Deploy every day at 3 A.M.
  branches:
    include:
    - release
  always: false


stages:
- stage: 'Build'
  displayName: 'Build the Solution'
  jobs: 
  - job: BuildDacpac
    pool:
      vmImage: 'windows-2019'
    steps:
    - task: VSBuild@1
      displayName: 'Build the database project'
      inputs:
        project: '**/*.sqlproj'

    - task: CopyFiles@2
      displayName: 'Copy dacpac file to staging directory'
      inputs:
        contents: |
          DataWarehouse/bin/**/*.dacpac
          Staging/bin/**/*.dacpac
        targetFolder: '$(Build.StagingDirectory)'

    - task: PublishBuildArtifacts@1
      displayName: 'Publish Artifact'
      inputs:
        pathToPublish: '$(Build.ArtifactStagingDirectory)'
        artifactName: dropDacpac
      condition: succeededOrFailed()

